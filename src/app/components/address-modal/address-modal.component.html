<div 
  *ngIf="isOpen" 
  class="fixed inset-0 z-50 flex items-center justify-center"
  [class.animate-fadeIn]="!isClosing()"
  [class.animate-fadeOut]="isClosing()"
  (click)="onOverlayClick($event)"
>
  <!-- Backdrop -->
  <div class="absolute inset-0 bg-black/50"></div>
  
  <!-- Modal Content -->
  <div 
    class="modal-container"
    [class.animate-slideUp]="!isClosing()"
    [class.animate-slideDown]="isClosing()"
  >
    <!-- Floating Close Button - Unified modal close button style -->
    <button 
      (click)="close()"
      class="modal-close-btn"
      aria-label="Đóng cửa sổ chọn địa chỉ"
      type="button"
    >
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>

    <!-- Header -->
    <div class="modal-header flex items-center justify-center p-4 border-b">
      <h2 class="text-xl font-bold modal-title">Chọn địa chỉ giao hàng</h2>
    </div>

    <!-- Address List -->
    <div class="flex-1 overflow-y-auto p-4 space-y-3">
      <div 
        *ngFor="let address of addresses"
        class="address-card cursor-pointer transition-all duration-200 rounded-lg border p-4"
        [class.border-primary]="isSelected(address.id)"
        [class.bg-primary-light]="isSelected(address.id)"
        [class.address-card-unselected]="!isSelected(address.id)"
        (click)="selectAddressItem(address)"
      >
        <div class="flex items-start justify-between">
          <div class="flex-1 min-w-0">
            <div class="flex items-center gap-2 mb-1">
              <span class="font-semibold address-name">{{ address.name }}</span>
              <span *ngIf="address.isDefault" class="px-2 py-0.5 bg-primary/10 text-primary text-xs font-medium rounded">
                Mặc định
              </span>
            </div>
            <p class="text-sm address-phone mb-1">{{ address.phone }}</p>
            <p class="text-sm address-text line-clamp-2">{{ address.address }}</p>
          </div>
          
          <!-- Selection Indicator - Hình vuông bo tròn -->
          <div class="ml-3 flex-shrink-0">
            <div 
              class="w-5 h-5 rounded border-[1.5px] flex items-center justify-center transition-all"
              [class.bg-primary]="isSelected(address.id)"
              [class.border-primary]="isSelected(address.id)"
              [class.checkbox-unselected]="!isSelected(address.id)"
            >
              <svg 
                *ngIf="isSelected(address.id)"
                class="w-3 h-3 text-white" 
                fill="none" 
                stroke="currentColor" 
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M5 13l4 4L19 7"/>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Add New Address Button -->
      <button 
        (click)="onAddNew()"
        class="add-address-btn w-full p-4 border border-dashed rounded-lg transition-colors flex items-center justify-center gap-2"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
        </svg>
        <span class="font-medium">Thêm địa chỉ mới</span>
      </button>

      <!-- Empty State -->
      <div *ngIf="addresses.length === 0" class="text-center py-8">
        <svg class="w-16 h-16 empty-state-icon mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
        <p class="empty-state-text mb-4">Bạn chưa có địa chỉ nào</p>
        <button 
          (click)="onAddNew()"
          class="px-6 py-2.5 bg-primary text-white font-semibold rounded-lg hover:bg-primary-hover transition-colors"
        >
          Thêm địa chỉ đầu tiên
        </button>
      </div>
    </div>

    <!-- Footer -->
    <div class="modal-footer p-4 border-t">
      <div class="flex gap-3">
        <button 
          (click)="close()"
          class="btn-cancel flex-1 px-4 py-2.5 border font-medium rounded-lg transition-colors"
        >
          Hủy
        </button>
        <button 
          (click)="onConfirm()"
          class="flex-1 px-4 py-2.5 bg-primary text-white font-semibold rounded-lg hover:bg-primary-hover transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          [disabled]="!selectedAddressId()"
        >
          Xác nhận
        </button>
      </div>
    </div>
  </div>
</div>
